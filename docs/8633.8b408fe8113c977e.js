"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8633],{8633:(v,u,c)=>{c.r(u),c.d(u,{OrdersPageModule:()=>Z});var l=c(9808),d=c(4182),r=c(4433),m=c(8599),_=c(655),f=c(4850),e=c(5e3),C=c(4524),O=c(7451);function P(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"ion-item")(1,"ion-label"),e._uU(2,"Amount Range"),e.qZA(),e.TgZ(3,"ion-range",12),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().amountRange=i})("ionChange",function(){return e.CHM(t),e.oxw().filterReceipts()}),e.TgZ(4,"ion-label",13),e._uU(5),e.qZA(),e.TgZ(6,"ion-label",14),e._uU(7),e.qZA()(),e.TgZ(8,"ion-label"),e._uU(9),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("ngModel",t.amountRange)("min",t.minAmount)("max",t.maxAmount)("step",100),e.xp6(2),e.hij("R",t.minAmount,""),e.xp6(2),e.hij("R",t.maxAmount,""),e.xp6(2),e.AsE("R",t.amountRange.lower," - R",t.amountRange.upper,"")}}function M(o,a){if(1&o&&(e.TgZ(0,"ion-item")(1,"ion-label")(2,"h3"),e._uU(3),e.qZA(),e.TgZ(4,"p"),e._uU(5),e.ALo(6,"number"),e.qZA()()()),2&o){const t=a.$implicit;e.xp6(3),e.Oqu(t.name),e.xp6(2),e.AsE("Price: R",e.lcZ(6,3,t.price)," x ",t.quantity,"")}}function x(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"ion-item")(1,"ion-label")(2,"h2",16),e._uU(3),e.qZA(),e.TgZ(4,"p"),e._uU(5),e.ALo(6,"date"),e.qZA(),e.TgZ(7,"p"),e._uU(8),e.ALo(9,"number"),e.qZA(),e.TgZ(10,"p"),e._uU(11),e.qZA(),e.TgZ(12,"ion-list"),e.YNc(13,M,7,5,"ion-item",15),e.qZA()(),e.TgZ(14,"ion-button",17),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).confirmDelete(s.id)}),e._UZ(15,"ion-icon",18),e.qZA()()}if(2&o){const t=a.$implicit;e.xp6(3),e.Oqu(t.email),e.xp6(2),e.hij("Date: ",e.xi3(6,5,t.timestamp,"medium"),""),e.xp6(3),e.hij("Total Amount: R",e.lcZ(9,8,t.totalAmount),""),e.xp6(3),e.hij("Receipt ID: ",t.id,""),e.xp6(2),e.Q6J("ngForOf",t.items)}}function b(o,a){if(1&o&&(e.TgZ(0,"ion-list"),e.YNc(1,x,16,10,"ion-item",15),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.filteredReceipts)}}function A(o,a){1&o&&(e.TgZ(0,"ion-card")(1,"ion-card-content"),e._uU(2,"No matching receipts found."),e.qZA()())}const T=[{path:"",component:(()=>{class o{constructor(t,n,i,s){this.firestore=t,this.auth=n,this.alertController=i,this.router=s,this.receipts=[],this.filteredReceipts=[],this.searchTerm="",this.dateFilter="",this.filterType="email",this.amountRange={lower:0,upper:1e4},this.minAmount=0,this.maxAmount=1e4,this.currentUserEmail="",this.isAdmin=!1}ngOnInit(){this.getCurrentUserEmail().then(t=>{this.currentUserEmail=t,this.isAdmin=this.checkIfAdmin(t),this.loadReceipts()}).catch(t=>{console.error("Error fetching user email:",t)})}getCurrentUserEmail(){return new Promise((t,n)=>{this.auth.authState.pipe((0,f.U)(i=>(null==i?void 0:i.email)||"")).subscribe({next:i=>t(i),error:i=>n(i)})})}checkIfAdmin(t){return"admin@gmail.com"===t||"siphelelemaphumulo@gmail.com"===t}loadReceipts(){this.firestore.collection("receipts").valueChanges({idField:"id"}).subscribe(t=>{this.receipts=this.isAdmin?t:t.filter(n=>n.email===this.currentUserEmail),this.calculateAmountRange(),this.filteredReceipts=[...this.receipts],this.sortReceipts()})}calculateAmountRange(){if(this.receipts.length>0){const t=this.receipts.map(n=>n.totalAmount||0);this.minAmount=100*Math.floor(Math.min(...t)/100),this.maxAmount=100*Math.ceil(Math.max(...t)/100),this.amountRange={lower:this.minAmount,upper:this.maxAmount}}}getSearchPlaceholder(){switch(this.filterType){case"email":return"Filter by email";case"receiptId":return"Filter by Receipt ID";case"amount":return"Filter by amount";default:return"Filter"}}resetFilters(){this.searchTerm="",this.dateFilter="",this.amountRange={lower:this.minAmount,upper:this.maxAmount},this.filterReceipts()}sortReceipts(){this.filteredReceipts.sort((t,n)=>new Date(n.timestamp).getTime()-new Date(t.timestamp).getTime())}filterReceipts(){this.filteredReceipts=this.receipts.filter(t=>{var n,i;let s=!0;if(this.searchTerm){const g=this.searchTerm.toLowerCase();"email"===this.filterType?s=null===(n=t.email)||void 0===n?void 0:n.toLowerCase().includes(g):"receiptId"===this.filterType&&(s=null===(i=t.id)||void 0===i?void 0:i.toLowerCase().includes(g))}let p=!0;this.dateFilter&&(p=new Date(t.timestamp).toDateString()===new Date(this.dateFilter).toDateString());let h=!0;return"amount"===this.filterType&&(h=t.totalAmount>=this.amountRange.lower&&t.totalAmount<=this.amountRange.upper),s&&p&&h}),this.sortReceipts()}clearDateFilter(){this.dateFilter="",this.filterReceipts()}confirmDelete(t){return(0,_.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:"Confirm Delete",message:"Are you sure you want to delete this receipt?",buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",handler:()=>this.deleteReceipt(t)}]})).present()})}deleteReceipt(t){this.firestore.collection("receipts").doc(t).delete().then(()=>{console.log("Receipt deleted successfully"),this.receipts=this.receipts.filter(n=>n.id!==t),this.calculateAmountRange(),this.filterReceipts()}).catch(n=>{console.error("Error deleting receipt:",n)})}writeReview(t){var n;const i={prodID:(null===(n=t.id)||void 0===n?void 0:n.toString())||"unknown",title:t.name||"Unknown Product",price:t.price||0,image:t.image||"assets/default-product.png"};this.router.navigate(["/reviews"],{state:{product:i}})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(C.ST),e.Y36(O.zQ),e.Y36(r.Br),e.Y36(m.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-orders"]],decls:23,vars:6,consts:[["color","shade"],["slot","start","color","shade",1,"menu_btn"],["defaultHref","/"],[2,"text-align","center"],[3,"ngModel","ngModelChange","ionChange"],["value","email"],["value","receiptId"],["value","amount"],[3,"ngModel","placeholder","ngModelChange","ionChange"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["noReceipts",""],["dualKnobs","true",3,"ngModel","min","max","step","ngModelChange","ionChange"],["slot","start"],["slot","end"],[4,"ngFor","ngForOf"],[1,"receipt-email"],["slot","end","color","danger","fill","clear",3,"click"],["name","trash","slot","icon-only"]],template:function(t,n){if(1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e._UZ(3,"ion-back-button",2),e.qZA(),e.TgZ(4,"ion-title",3),e._uU(5,"Receipt Histories"),e.qZA()()(),e.TgZ(6,"ion-content")(7,"ion-toolbar")(8,"ion-segment",4),e.NdJ("ngModelChange",function(s){return n.filterType=s})("ionChange",function(){return n.resetFilters()}),e.TgZ(9,"ion-segment-button",5)(10,"ion-label"),e._uU(11,"Email"),e.qZA()(),e.TgZ(12,"ion-segment-button",6)(13,"ion-label"),e._uU(14,"Receipt ID"),e.qZA()(),e.TgZ(15,"ion-segment-button",7)(16,"ion-label"),e._uU(17,"Amount"),e.qZA()()(),e.TgZ(18,"ion-searchbar",8),e.NdJ("ngModelChange",function(s){return n.searchTerm=s})("ionChange",function(){return n.filterReceipts()}),e.qZA(),e.YNc(19,P,10,8,"ion-item",9),e.qZA(),e.YNc(20,b,2,1,"ion-list",10),e.YNc(21,A,3,0,"ng-template",null,11,e.W1O),e.qZA()),2&t){const i=e.MAs(22);e.xp6(8),e.Q6J("ngModel",n.filterType),e.xp6(10),e.Q6J("ngModel",n.searchTerm)("placeholder",n.getSearchPlaceholder()),e.xp6(1),e.Q6J("ngIf","amount"===n.filterType),e.xp6(1),e.Q6J("ngIf",n.filteredReceipts&&n.filteredReceipts.length>0)("ngIfElse",i)}},directives:[r.Gu,r.sr,r.Sm,r.oU,r.cs,r.wd,r.W2,r.cJ,r.QI,d.JJ,d.On,r.GO,r.Q$,r.VI,r.j9,l.O5,r.Ie,r.I_,r.q_,l.sg,r.YG,r.gu,r.PM,r.FN],pipes:[l.uU,l.JJ],styles:['[_ngcontent-%COMP%]:root{--primary-color: rgb(7, 161, 233);--secondary-color: rgb(67, 7, 233);--gray-color: #ccc;--font-family: "Poppins", sans-serif;--font-size-small: 16px;--font-size-medium: 22px;--border-radius: 10px;--border-color: #aeb7ca}.grid[_ngcontent-%COMP%]{color:#000;font-size:var(--font-size-medium);font-weight:700;border-color:var(--border-color);border-radius:var(--border-radius);border-style:solid;margin-bottom:-1px;background:#cdcfd6}.grid[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{border:2px solid var(--border-color)}ion-header[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:30px;position:relative;margin-left:10px}ion-header[_ngcontent-%COMP%]   #notification-badge-msg[_ngcontent-%COMP%], ion-header[_ngcontent-%COMP%]   #notification-badge[_ngcontent-%COMP%]{position:absolute;top:5px;color:#fff;z-index:111}ion-header[_ngcontent-%COMP%]   #notification-badge-msg[_ngcontent-%COMP%]{background-color:var(--secondary-color);right:95px}ion-header[_ngcontent-%COMP%]   #notification-badge[_ngcontent-%COMP%]{background-color:var(--primary-color);right:45px}ion-header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:35px;height:45px;border-radius:50%;margin-right:10px}ion-content[_ngcontent-%COMP%]{--background-color: #f9f9f9;font-family:var(--font-family)}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]{background-color:#fff;margin-top:10px;box-shadow:#00000026 1.95px 1.95px 2.6px;height:auto;display:grid;grid-template-columns:40% 35% 15% 10%;grid-template-rows:15% 35% 35% 15%;grid-gap:5px 5px;gap:5px 5px;grid-template-areas:"image title title menu" "image orderId orderId orderId" "image amount status status" "image time edit edit"}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{grid-area:image}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{padding:10px;border-radius:5px;width:100%;height:auto}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:#000;grid-area:title}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:var(--font-size-small)}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]{grid-area:menu;margin-left:-10px;justify-self:center}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-right:10px;color:red}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .orderId[_ngcontent-%COMP%]{grid-area:orderId;margin-right:10px}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .orderId[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:gray}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{grid-area:amount;align-self:start;justify-self:start;margin-top:-25px}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .edit[_ngcontent-%COMP%]{grid-area:edit;margin-top:-30px;margin-right:20px}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .edit[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]{height:auto;width:100%;display:flex;align-items:center;justify-content:center;background:#fff;border-radius:22px;box-shadow:0 5px 10px #0003}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .edit[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:100%;text-align:center;font-size:var(--font-size-medium);font-weight:600;cursor:pointer;-webkit-user-select:none;user-select:none}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .edit[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]   span.num[_ngcontent-%COMP%]{font-size:var(--font-size-medium);border-right:2px solid rgba(0,0,0,.2);border-left:2px solid rgba(0,0,0,.2);pointer-events:none;color:#41f041}ion-content[_ngcontent-%COMP%]   #moreItems[_ngcontent-%COMP%]{text-align:center;color:red}ion-content[_ngcontent-%COMP%]   .order_summary[_ngcontent-%COMP%]{width:100%;background-color:#fff;margin-top:10px;box-shadow:#00000026 1.95px 1.95px 2.6px;height:auto;padding:10px}ion-content[_ngcontent-%COMP%]   .order_summary[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:red}ion-content[_ngcontent-%COMP%]   .order_summary[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:gray;margin-left:20px;margin-right:20px;border-bottom:1px solid grey}ion-content[_ngcontent-%COMP%]   .order_summary[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{float:right;margin-right:10px}.receipt-email[_ngcontent-%COMP%]{color:#000;font-weight:700}ion-modal[_ngcontent-%COMP%]{--width: 90%;--height: 80%;--border-radius: 16px}']}),o})()}];let R=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[m.Bz.forChild(T)],m.Bz]}),o})(),Z=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[l.ez,d.u5,r.Pc,R]]}),o})()}}]);