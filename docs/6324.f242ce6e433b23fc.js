"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6324],{6324:(U,p,l)=>{l.r(p),l.d(p,{ReviewsPageModule:()=>A});var g=l(9808),h=l(4182),r=l(4433),_=l(8599),u=l(655),e=l(5e3),m=l(4524),v=l(1447);function f(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"ion-item",2),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(4).selectProduct(s)}),e.TgZ(1,"ion-thumbnail",1),e._UZ(2,"img",14),e.qZA(),e.TgZ(3,"ion-label")(4,"h3"),e._uU(5),e.qZA(),e.TgZ(6,"p"),e._uU(7),e.qZA()()()}if(2&o){const t=c.$implicit;e.xp6(2),e.Q6J("src",t.image,e.LSH)("alt",t.title),e.xp6(3),e.Oqu(t.title),e.xp6(2),e.Oqu(t.prodID)}}function w(o,c){if(1&o&&(e.TgZ(0,"ion-list"),e.YNc(1,f,8,4,"ion-item",13),e.qZA()),2&o){const t=e.oxw(3);e.xp6(1),e.Q6J("ngForOf",t.searchResults)}}function x(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"ion-item")(2,"ion-label",12),e._uU(3,"Search by Product Name or ID"),e.qZA(),e.TgZ(4,"ion-input",9),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw(2).searchTerm=n})("ionChange",function(){return e.CHM(t),e.oxw(2).searchProducts()}),e.qZA()(),e.YNc(5,w,2,1,"ion-list",6),e.qZA()}if(2&o){const t=e.oxw(2);e.xp6(4),e.Q6J("ngModel",t.searchTerm),e.xp6(1),e.Q6J("ngIf",t.searchResults.length>0)}}function P(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"ion-item",2),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(3).selectProduct(s.product)}),e.TgZ(1,"ion-thumbnail",1),e._UZ(2,"img",14),e.qZA(),e.TgZ(3,"ion-label")(4,"h3"),e._uU(5),e.qZA(),e.TgZ(6,"p"),e._uU(7),e.ALo(8,"date"),e.qZA(),e.TgZ(9,"p"),e._uU(10),e.qZA()()()}if(2&o){const t=c.$implicit;e.xp6(2),e.Q6J("src",t.product.image,e.LSH)("alt",t.product.title),e.xp6(3),e.Oqu(t.product.title),e.xp6(2),e.hij("Purchased: ",e.lcZ(8,5,t.date),""),e.xp6(3),e.hij("Quantity: ",t.quantity,"")}}function C(o,c){if(1&o&&(e.TgZ(0,"div")(1,"ion-list"),e.YNc(2,P,11,7,"ion-item",13),e.qZA()()),2&o){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",t.purchasedItems)}}function Z(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e._uU(3,"Select a Product to Review"),e.qZA()(),e.TgZ(4,"ion-card-content")(5,"ion-segment",9),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().searchMode=n})("ionChange",function(){return e.CHM(t),e.oxw().onSearchModeChange()}),e.TgZ(6,"ion-segment-button",10)(7,"ion-label"),e._uU(8,"Search"),e.qZA()(),e.TgZ(9,"ion-segment-button",11)(10,"ion-label"),e._uU(11,"My Purchases"),e.qZA()()(),e.YNc(12,x,6,2,"div",6),e.YNc(13,C,3,1,"div",6),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(5),e.Q6J("ngModel",t.searchMode),e.xp6(7),e.Q6J("ngIf","search"===t.searchMode),e.xp6(1),e.Q6J("ngIf","purchased"===t.searchMode)}}function T(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"ion-card",15)(1,"ion-card-header")(2,"ion-card-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-button",16),e.NdJ("click",function(){return e.CHM(t),e.oxw().changeProduct()}),e._UZ(5,"ion-icon",17),e._uU(6," Change Product "),e.qZA()(),e.TgZ(7,"ion-card-content")(8,"div",18)(9,"ion-thumbnail"),e._UZ(10,"img",14),e.qZA(),e.TgZ(11,"div",19)(12,"p"),e._uU(13),e.qZA(),e.TgZ(14,"p"),e._uU(15),e.ALo(16,"currency"),e.qZA()()()()()}if(2&o){const t=e.oxw();e.xp6(3),e.Oqu(t.selectedProduct.title),e.xp6(7),e.Q6J("src",t.selectedProduct.image,e.LSH)("alt",t.selectedProduct.title),e.xp6(3),e.hij("Product ID: ",t.selectedProduct.prodID,""),e.xp6(2),e.hij("Price: ",e.Dn7(16,5,t.selectedProduct.price,"ZAR","symbol"),"")}}function M(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"ion-icon",27),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).setRating(s)}),e.qZA()}if(2&o){const t=c.$implicit,i=e.oxw(2);e.Q6J("name",i.rating>=t?"star":"star-outline")("color",i.rating>=t?"warning":"medium")}}const y=function(){return[1,2,3,4,5]};function R(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"ion-card",20)(1,"ion-card-header")(2,"ion-card-title"),e._uU(3,"Your Review"),e.qZA()(),e.TgZ(4,"ion-card-content")(5,"div",21)(6,"h3"),e._uU(7,"Overall Rating"),e.qZA(),e.TgZ(8,"div",22),e.YNc(9,M,1,2,"ion-icon",23),e.qZA()(),e.TgZ(10,"ion-item")(11,"ion-label",12),e._uU(12,"Review Title"),e.qZA(),e.TgZ(13,"ion-input",24),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().review.title=n}),e._uU(14),e.qZA()(),e.TgZ(15,"ion-item")(16,"ion-label",12),e._uU(17,"Your Review"),e.qZA(),e.TgZ(18,"ion-textarea",25),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().review.content=n}),e.qZA()(),e.TgZ(19,"ion-button",26),e.NdJ("click",function(){return e.CHM(t),e.oxw().submitReview()}),e._uU(20," Submit Review "),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(9),e.Q6J("ngForOf",e.DdM(5,y)),e.xp6(4),e.Q6J("ngModel",t.review.title),e.xp6(1),e.Oqu(t.selectedProduct.title),e.xp6(4),e.Q6J("ngModel",t.review.content),e.xp6(1),e.Q6J("disabled",!t.rating||!t.review.content)}}const b=[{path:"",component:(()=>{class o{constructor(t,i,n,s,a,d,I,q){this.navCtrl=t,this.router=i,this.route=n,this.firestore=s,this.loadingCtrl=a,this.toastCtrl=d,this.alertCtrl=I,this.fireService=q,this.selectedProduct=null,this.searchTerm="",this.searchResults=[],this.purchasedItems=[],this.rating=0,this.searchMode="purchased",this.review={title:"",content:"",date:(new Date).toISOString(),userId:"",userEmail:"",userName:"",productId:"",productName:"",rating:0,status:"pending"}}ngOnInit(){var t;return(0,u.mG)(this,void 0,void 0,function*(){const i=this.router.getCurrentNavigation(),n=null===(t=null==i?void 0:i.extras)||void 0===t?void 0:t.state;n&&n.product&&(this.selectedProduct=this.sanitizeProductData(n.product),console.log("Received product from state:",this.selectedProduct)),yield this.initializeReview(),yield this.loadPurchasedItems()})}sanitizeProductData(t){var i;return{prodID:(null===(i=t.prodID)||void 0===i?void 0:i.toString())||"unknown",title:t.title||"Unknown Product",price:t.price||0,image:t.image||"assets/default-product.png"}}initializeReview(){return(0,u.mG)(this,void 0,void 0,function*(){if(this.selectedProduct){this.review.productId=this.selectedProduct.prodID,this.review.productName=this.selectedProduct.title,this.review.title=this.selectedProduct.title;const t=yield this.fireService.getCurrentUser();if(t){this.review.userId=t.uid,this.review.userEmail=t.email||"";try{const i=yield this.firestore.collection("users").doc(t.uid).get().toPromise(),n=null==i?void 0:i.data();this.review.userName=(null==n?void 0:n.name)||t.displayName||(t.email?t.email.split("@")[0]:"User")}catch(i){console.error("Error fetching user data:",i),this.review.userName=t.displayName||(t.email?t.email.split("@")[0]:"User")}}}})}loadPurchasedItems(){return(0,u.mG)(this,void 0,void 0,function*(){const t=yield this.loadingCtrl.create({message:"Loading your purchases..."});yield t.present();try{const i=yield this.fireService.getCurrentUser();if(!(null==i?void 0:i.email))return;const n=yield this.firestore.collection("receipts",s=>s.where("email","==",i.email)).get().toPromise();this.purchasedItems=[],null==n||n.forEach(s=>{const a=s.data();(null==a?void 0:a.items)&&a.items.forEach(d=>{this.purchasedItems.push({product:{prodID:d.id.toString(),title:d.name,price:d.price,image:d.image||"assets/default-product.png"},date:a.timestamp,quantity:d.quantity})})})}catch(i){console.error("Error loading purchases:",i),this.showToast("Error loading your purchases","danger")}finally{t.dismiss()}})}getProductImage(t){return"assets/default-product.png"}onSearchModeChange(){this.searchTerm="",this.searchResults=[]}changeProduct(){return(0,u.mG)(this,void 0,void 0,function*(){(yield this.fireService.getCartOnce()).length>1?this.router.navigate(["/cart"]):this.selectedProduct=null})}searchProducts(){return(0,u.mG)(this,void 0,void 0,function*(){if(this.searchTerm.length<2)return void(this.searchResults=[]);const t=yield this.loadingCtrl.create({message:"Searching products..."});yield t.present();try{const i=this.searchTerm.toLowerCase(),n=yield this.firestore.collection("products").get().toPromise();this.searchResults=n.docs.map(s=>Object.assign({id:s.id},s.data())).filter(s=>{var a,d;return(null===(a=s.title)||void 0===a?void 0:a.toLowerCase().includes(i))||(null===(d=s.prodID)||void 0===d?void 0:d.toLowerCase().includes(i))})}catch(i){console.error("Search error:",i),this.showToast("Error searching products","danger")}finally{t.dismiss()}})}selectProduct(t){this.selectedProduct=t,this.initializeReview()}setRating(t){this.rating=t,this.review.rating=t}submitReview(){return(0,u.mG)(this,void 0,void 0,function*(){if(!this.rating||!this.review.content)return void this.showToast("Please complete all required fields and rating","warning");if(!this.selectedProduct)return void this.showToast("Please select a product to review","warning");const t=yield this.loadingCtrl.create({message:"Submitting your review..."});yield t.present();try{if(!(yield this.fireService.getCurrentUser()))throw new Error("User not authenticated");const n=Object.assign(Object.assign({},this.review),{rating:this.rating,date:(new Date).toISOString(),status:"pending"});yield this.fireService.submitReview(n),this.showToast("Thank you for your review!","success"),this.resetForm()}catch(i){console.error("Review submission error:",i);let n="Error submitting review";"permission-denied"===i.code&&(n="Permission denied. Please sign in."),this.showToast(n,"danger")}finally{t.dismiss()}})}resetForm(){this.selectedProduct=null,this.rating=0,this.review={title:"",content:"",date:(new Date).toISOString(),userId:"",userEmail:"",userName:"",productId:"",productName:"",rating:0,status:"pending"}}goBack(){this.navCtrl.back()}showToast(t,i="primary"){return(0,u.mG)(this,void 0,void 0,function*(){yield(yield this.toastCtrl.create({message:t,duration:3e3,color:i,position:"bottom"})).present()})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(r.SH),e.Y36(_.F0),e.Y36(_.gz),e.Y36(m.ST),e.Y36(r.HT),e.Y36(r.yF),e.Y36(r.Br),e.Y36(v.Q))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-reviews"]],decls:16,vars:3,consts:[["color","shade"],["slot","start"],[3,"click"],["defaultHref","/"],[1,"ion-padding"],[1,"review-header"],[4,"ngIf"],["class","product-card",4,"ngIf"],["class","review-form",4,"ngIf"],[3,"ngModel","ngModelChange","ionChange"],["value","search"],["value","purchased"],["position","floating"],[3,"click",4,"ngFor","ngForOf"],[3,"src","alt"],[1,"product-card"],["fill","clear",3,"click"],["name","close","slot","start"],[1,"product-info"],[1,"product-details"],[1,"review-form"],[1,"rating-section"],[1,"stars"],[3,"name","color","click",4,"ngFor","ngForOf"],[3,"ngModel","ngModelChange"],["rows","5","placeholder","Tell us about your experience with this product...",3,"ngModel","ngModelChange"],["expand","block","color","primary",3,"disabled","click"],[3,"name","color","click"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1)(3,"ion-button",2),e.NdJ("click",function(){return i.goBack()}),e._UZ(4,"ion-back-button",3),e.qZA()(),e.TgZ(5,"ion-title"),e._uU(6,"Share Your Experience"),e.qZA()()(),e.TgZ(7,"ion-content",4)(8,"div",5)(9,"h2"),e._uU(10,"We value your feedback!"),e.qZA(),e.TgZ(11,"p"),e._uU(12,"Help us improve by sharing your experience with our products"),e.qZA()(),e.YNc(13,Z,14,3,"ion-card",6),e.YNc(14,T,17,9,"ion-card",7),e.YNc(15,R,21,6,"ion-card",8),e.qZA()),2&t&&(e.xp6(13),e.Q6J("ngIf",!i.selectedProduct),e.xp6(1),e.Q6J("ngIf",i.selectedProduct),e.xp6(1),e.Q6J("ngIf",i.selectedProduct))},directives:[r.Gu,r.sr,r.Sm,r.YG,r.oU,r.cs,r.wd,r.W2,g.O5,r.PM,r.Zi,r.Dq,r.FN,r.cJ,r.QI,h.JJ,h.On,r.GO,r.Q$,r.Ie,r.pK,r.j9,r.q_,g.sg,r.Bs,r.gu,r.g2],pipes:[g.uU,g.H9],styles:[".review-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:24px}.review-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-weight:700}.product-card[_ngcontent-%COMP%]{border-radius:12px;margin-bottom:16px}.product-info[_ngcontent-%COMP%]{display:flex;align-items:center}.product-info[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{width:80px;height:80px;margin-right:16px}.product-details[_ngcontent-%COMP%]{flex:1}.review-form[_ngcontent-%COMP%]{border-radius:12px}.rating-section[_ngcontent-%COMP%]{margin-bottom:20px;text-align:center}.stars[_ngcontent-%COMP%]{font-size:32px;margin:12px 0}.stars[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin:0 4px;cursor:pointer}.photo-upload[_ngcontent-%COMP%]{margin:20px 0}.photo-grid[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}.photo-box[_ngcontent-%COMP%]{width:100px;height:100px;border:1px dashed var(--ion-color-medium);border-radius:8px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}.photo-box[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.add-photo[_ngcontent-%COMP%]{flex-direction:column;color:var(--ion-color-medium);cursor:pointer}.add-photo[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}.add-photo[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:12px}"]}),o})()}];let O=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[_.Bz.forChild(b)],_.Bz]}),o})(),A=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[g.ez,h.u5,r.Pc,O]]}),o})()}}]);