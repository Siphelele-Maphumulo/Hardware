"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5285],{5285:(b,h,i)=>{i.r(h),i.d(h,{UsersPageModule:()=>x});var d=i(9808),g=i(4182),s=i(4433),m=i(8599),c=i(655),e=i(5e3),p=i(1447),f=i(4524),_=i(1328);function U(r,a){if(1&r){const t=e.EpF();e.TgZ(0,"ion-item")(1,"ion-label")(2,"h2",11),e._uU(3),e.qZA(),e.TgZ(4,"p"),e._uU(5),e.qZA(),e.TgZ(6,"p"),e._uU(7),e.qZA(),e.TgZ(8,"p"),e._uU(9),e.qZA()(),e.TgZ(10,"ion-button",12),e.NdJ("click",function(){const l=e.CHM(t).$implicit;return e.oxw(2).editUser(l)}),e._UZ(11,"ion-icon",13),e.qZA(),e.TgZ(12,"ion-button",14),e.NdJ("click",function(){const l=e.CHM(t).$implicit;return e.oxw(2).confirmDelete(l.uid)}),e._UZ(13,"ion-icon",15),e.qZA()()}if(2&r){const t=a.$implicit;e.xp6(3),e.AsE("",t.name," ",t.surname,""),e.xp6(2),e.hij("Email: ",t.email,""),e.xp6(2),e.hij("Username: ",t.username,""),e.xp6(2),e.hij("Contact: ",t.contact,"")}}function P(r,a){if(1&r&&(e.TgZ(0,"ion-list"),e.YNc(1,U,14,5,"ion-item",10),e.qZA()),2&r){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.filteredUsers)}}function C(r,a){1&r&&(e.TgZ(0,"ion-card")(1,"ion-card-content"),e._uU(2,"No matching users found."),e.qZA()())}const M=[{path:"",component:(()=>{class r{constructor(t,n,o,l,u,y,v){this.fireService=t,this.firestore=n,this.toastCtrl=o,this.loadingCtrl=l,this.alertCtrl=u,this.modalCtrl=y,this.authService=v,this.users=[],this.currentUser={name:"",surname:"",username:"",email:"",contact:"",password:"",cPass:"",uid:"",displayName:"",photoURL:"",emailVerified:!1},this.editingUser=null,this.isModalOpen=!1,this.showPassword=!1,this.searchTerm="",this.filteredUsers=[],this.isAdmin=!0}ngOnInit(){this.checkAdminStatus(),this.loadUsers()}checkAdminStatus(){var t;return(0,c.mG)(this,void 0,void 0,function*(){const n=yield this.afAuth.currentUser,o=yield null==n?void 0:n.getIdTokenResult();this.isAdmin=(null===(t=null==o?void 0:o.claims)||void 0===t?void 0:t.admin)||!1})}loadUsers(){this.fireService.getAllUsersSimple().subscribe(t=>{this.users=t,this.filteredUsers=[...this.users],console.log("Users loaded:",this.users)})}filterUsers(){if(!this.searchTerm)return void(this.filteredUsers=[...this.users]);const t=this.searchTerm.toLowerCase();this.filteredUsers=this.users.filter(n=>n.email.toLowerCase().includes(t)||n.username.toLowerCase().includes(t)||n.contact.toLowerCase().includes(t))}openAddUserModal(){this.currentUser={name:"",surname:"",username:"",email:"",contact:"",password:"",cPass:"",uid:"",displayName:"",photoURL:"",emailVerified:!1},this.editingUser=null,this.isModalOpen=!0}editUser(t){this.currentUser=Object.assign({},t),this.editingUser=t,this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.currentUser={name:"",surname:"",username:"",email:"",contact:"",password:"",cPass:"",uid:"",displayName:"",photoURL:"",emailVerified:!1},this.editingUser=null}togglePasswordVisibility(){this.showPassword=!this.showPassword}saveUser(){return(0,c.mG)(this,void 0,void 0,function*(){if(!this.validateUser())return;const t=yield this.loadingCtrl.create({message:this.editingUser?"Updating user...":"Creating user..."});yield t.present();try{this.editingUser?yield this.updateUser():yield this.createUser(),this.showToast(`User ${this.editingUser?"updated":"created"} successfully!`,"success"),this.closeModal()}catch(n){console.error("Error saving user:",n),this.showToast(n.message||"Error saving user","danger")}finally{t.dismiss()}})}createUser(){var t;return(0,c.mG)(this,void 0,void 0,function*(){const n=yield this.fireService.signup({email:this.currentUser.email,password:this.currentUser.password});if(null===(t=n.user)||void 0===t?void 0:t.uid){yield this.authService.SendVerificationMail();const o={name:this.currentUser.name,surname:this.currentUser.surname,username:this.currentUser.username,email:this.currentUser.email,contact:this.currentUser.contact,uid:n.user.uid,displayName:`${this.currentUser.name} ${this.currentUser.surname}`,photoURL:this.currentUser.photoURL||"",emailVerified:!1,password:"",cPass:""};yield this.fireService.saveDetails(o)}})}validateUser(){return this.currentUser.name&&this.currentUser.surname&&this.currentUser.username&&this.currentUser.contact&&this.currentUser.email?this.editingUser||this.currentUser.password&&this.currentUser.cPass?!(!this.editingUser&&this.currentUser.password!==this.currentUser.cPass&&(this.showToast("Passwords do not match","danger"),1)):(this.showToast("Please fill in password fields","danger"),!1):(this.showToast("Please fill in all fields","danger"),!1)}confirmDelete(t){return(0,c.mG)(this,void 0,void 0,function*(){yield(yield this.alertCtrl.create({header:"Confirm Delete",message:"Are you sure you want to delete this user?",buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",handler:()=>this.deleteUser(t)}]})).present()})}deleteUser(t){return(0,c.mG)(this,void 0,void 0,function*(){const n=yield this.loadingCtrl.create({message:"Deleting user..."});yield n.present();try{yield this.firestore.collection("users").doc(t).delete(),this.showToast("User deleted successfully","success")}catch(o){console.error("Error deleting user:",o),this.showToast("Error deleting user","danger")}finally{n.dismiss()}})}updateUser(){var t;return(0,c.mG)(this,void 0,void 0,function*(){if(!(null===(t=this.editingUser)||void 0===t?void 0:t.uid))return;const n=yield this.loadingCtrl.create({message:"Updating user..."});yield n.present();try{const o={name:this.currentUser.name,surname:this.currentUser.surname,username:this.currentUser.username,email:this.currentUser.email,contact:this.currentUser.contact,displayName:`${this.currentUser.name} ${this.currentUser.surname}`};yield this.fireService.updateUserData(this.editingUser.uid,o),this.currentUser.email!==this.editingUser.email&&(yield this.fireService.updateUserEmail(this.editingUser.uid,this.currentUser.email)),this.showToast("User updated successfully","success"),this.closeModal()}catch(o){this.showToast("Error updating user","danger"),console.error(o)}finally{n.dismiss()}})}showToast(t,n="success"){return(0,c.mG)(this,void 0,void 0,function*(){yield(yield this.toastCtrl.create({message:t,duration:3e3,color:n,position:"bottom"})).present()})}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(p.Q),e.Y36(f.ST),e.Y36(s.yF),e.Y36(s.HT),e.Y36(s.Br),e.Y36(s.IN),e.Y36(_.u))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-users"]],decls:14,vars:3,consts:[["color","shade"],["slot","start","color","shade",1,"menu_btn"],["defaultHref","/"],[2,"text-align","center"],["slot","end"],[3,"click"],["slot","icon-only","name","add"],["placeholder","Search by email, username or contact","debounce","300",3,"ngModel","ngModelChange","ionChange"],[4,"ngIf","ngIfElse"],["noUsers",""],[4,"ngFor","ngForOf"],[1,"user-name"],["slot","end","fill","clear",3,"click"],["name","create","slot","icon-only"],["slot","end","color","danger","fill","clear",3,"click"],["name","trash","slot","icon-only"]],template:function(t,n){if(1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e._UZ(3,"ion-back-button",2),e.qZA(),e.TgZ(4,"ion-title",3),e._uU(5,"Registered Users"),e.qZA(),e.TgZ(6,"ion-buttons",4)(7,"ion-button",5),e.NdJ("click",function(){return n.openAddUserModal()}),e._UZ(8,"ion-icon",6),e.qZA()()()(),e.TgZ(9,"ion-content")(10,"ion-searchbar",7),e.NdJ("ngModelChange",function(l){return n.searchTerm=l})("ionChange",function(){return n.filterUsers()}),e.qZA(),e.YNc(11,P,2,1,"ion-list",8),e.YNc(12,C,3,0,"ng-template",null,9,e.W1O),e.qZA()),2&t){const o=e.MAs(13);e.xp6(10),e.Q6J("ngModel",n.searchTerm),e.xp6(1),e.Q6J("ngIf",n.filteredUsers&&n.filteredUsers.length>0)("ngIfElse",o)}},directives:[s.Gu,s.sr,s.Sm,s.oU,s.cs,s.wd,s.YG,s.gu,s.W2,s.VI,s.j9,g.JJ,g.On,d.O5,s.q_,d.sg,s.Ie,s.Q$,s.PM,s.FN],styles:['[_ngcontent-%COMP%]:root{--primary-color: rgb(7, 161, 233);--secondary-color: rgb(67, 7, 233);--gray-color: #ccc;--font-family: "Poppins", sans-serif;--font-size-small: 16px;--font-size-medium: 22px;--border-radius: 10px;--border-color: #aeb7ca}.grid[_ngcontent-%COMP%]{color:#000;font-size:var(--font-size-medium);font-weight:700;border-color:var(--border-color);border-radius:var(--border-radius);border-style:solid;margin-bottom:-1px;background:#cdcfd6}.grid[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{border:2px solid var(--border-color)}ion-header[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:30px;position:relative;margin-left:10px}ion-header[_ngcontent-%COMP%]   #notification-badge-msg[_ngcontent-%COMP%], ion-header[_ngcontent-%COMP%]   #notification-badge[_ngcontent-%COMP%]{position:absolute;top:5px;color:#fff;z-index:111}ion-header[_ngcontent-%COMP%]   #notification-badge-msg[_ngcontent-%COMP%]{background-color:var(--secondary-color);right:95px}ion-header[_ngcontent-%COMP%]   #notification-badge[_ngcontent-%COMP%]{background-color:var(--primary-color);right:45px}ion-header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:35px;height:45px;border-radius:50%;margin-right:10px}ion-content[_ngcontent-%COMP%]{--background-color: #f9f9f9;font-family:var(--font-family)}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]{background-color:#fff;margin-top:10px;box-shadow:#00000026 1.95px 1.95px 2.6px;height:auto;display:grid;grid-template-columns:40% 35% 15% 10%;grid-template-rows:15% 35% 35% 15%;grid-gap:5px 5px;gap:5px 5px;grid-template-areas:"image title title menu" "image orderId orderId orderId" "image amount status status" "image time edit edit"}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{grid-area:image}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{padding:10px;border-radius:5px;width:100%;height:auto}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:#000;grid-area:title}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:var(--font-size-small)}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]{grid-area:menu;margin-left:-10px;justify-self:center}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-right:10px;color:red}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .orderId[_ngcontent-%COMP%]{grid-area:orderId;margin-right:10px}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .orderId[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:gray}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{grid-area:amount;align-self:start;justify-self:start;margin-top:-25px}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .edit[_ngcontent-%COMP%]{grid-area:edit;margin-top:-30px;margin-right:20px}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .edit[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]{height:auto;width:100%;display:flex;align-items:center;justify-content:center;background:#fff;border-radius:22px;box-shadow:0 5px 10px #0003}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .edit[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:100%;text-align:center;font-size:var(--font-size-medium);font-weight:600;cursor:pointer;-webkit-user-select:none;user-select:none}ion-content[_ngcontent-%COMP%]   .upperBox[_ngcontent-%COMP%]   .edit[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]   span.num[_ngcontent-%COMP%]{font-size:var(--font-size-medium);border-right:2px solid rgba(0,0,0,.2);border-left:2px solid rgba(0,0,0,.2);pointer-events:none;color:#41f041}ion-content[_ngcontent-%COMP%]   #moreItems[_ngcontent-%COMP%]{text-align:center;color:red}ion-content[_ngcontent-%COMP%]   .order_summary[_ngcontent-%COMP%]{width:100%;background-color:#fff;margin-top:10px;box-shadow:#00000026 1.95px 1.95px 2.6px;height:auto;padding:10px}ion-content[_ngcontent-%COMP%]   .order_summary[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:red}ion-content[_ngcontent-%COMP%]   .order_summary[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:gray;margin-left:20px;margin-right:20px;border-bottom:1px solid grey}ion-content[_ngcontent-%COMP%]   .order_summary[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{float:right;margin-right:10px}']}),r})()}];let O=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[m.Bz.forChild(M)],m.Bz]}),r})(),x=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[d.ez,g.u5,s.Pc,O]]}),r})()}}]);