"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7135],{7135:($,x,m)=>{m.r(x),m.d(x,{CheckoutPageModule:()=>N});var h,p=m(9808),b=m(2382),s=m(8161),f=m(6115),v=m(655),Z=new Uint8Array(16);function A(){if(!h&&!(h="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return h(Z)}const O=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,M=function w(e){return"string"==typeof e&&O.test(e)};for(var c=[],y=0;y<256;++y)c.push((y+256).toString(16).substr(1));const q=function S(e,n,o){var i=(e=e||{}).random||(e.rng||A)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,n){o=o||0;for(var r=0;r<16;++r)n[o+r]=i[r];return n}return function T(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=(c[e[n+0]]+c[e[n+1]]+c[e[n+2]]+c[e[n+3]]+"-"+c[e[n+4]]+c[e[n+5]]+"-"+c[e[n+6]]+c[e[n+7]]+"-"+c[e[n+8]]+c[e[n+9]]+"-"+c[e[n+10]]+c[e[n+11]]+c[e[n+12]]+c[e[n+13]]+c[e[n+14]]+c[e[n+15]]).toLowerCase();if(!M(o))throw TypeError("Stringified UUID is invalid");return o}(i)},g={_origin:"https://api.emailjs.com"};class C{constructor(n){this.status=n.status,this.text=n.responseText}}const E_send=(e,n,o,i)=>{const r=i||g._userID;return((e,n,o)=>{if(!e)throw"The user ID is required. Visit https://dashboard.emailjs.com/admin/integration";if(!n)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!o)throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"})(r,e,n),((e,n,o={})=>new Promise((i,r)=>{const a=new XMLHttpRequest;a.addEventListener("load",({target:l})=>{const u=new C(l);200===u.status||"OK"===u.text?i(u):r(u)}),a.addEventListener("error",({target:l})=>{r(new C(l))}),a.open("POST",g._origin+e,!0),Object.keys(o).forEach(l=>{a.setRequestHeader(l,o[l])}),a.send(n)}))("/api/v1.0/email/send",JSON.stringify({lib_version:"3.2.0",user_id:r,service_id:e,template_id:n,template_params:o}),{"Content-type":"application/json"})};var t=m(5e3),j=m(6131);function R(e,n){if(1&e&&(t.TgZ(0,"ion-thumbnail",1),t._UZ(1,"img",21),t.qZA()),2&e){const o=t.oxw().$implicit;t.xp6(1),t.Q6J("src",o.image,t.LSH)("alt",o.name)}}function z(e,n){if(1&e&&(t.TgZ(0,"ion-item",16),t.YNc(1,R,2,2,"ion-thumbnail",17),t.TgZ(2,"ion-label",18),t._uU(3),t.qZA(),t.TgZ(4,"ion-note",19),t._uU(5),t.ALo(6,"number"),t.TgZ(7,"div",20),t._uU(8),t.ALo(9,"number"),t.qZA()()()),2&e){const o=n.$implicit;t.xp6(1),t.Q6J("ngIf",o.image),t.xp6(2),t.Oqu(o.name),t.xp6(2),t.AsE(" ",o.quantity," \xd7 $",t.xi3(6,5,o.price,"1.2-2")," "),t.xp6(3),t.hij(" $",t.xi3(9,8,o.price*o.quantity,"1.2-2")," ")}}const J=[{path:"",component:(()=>{class e{constructor(o,i,r,a){this.fireService=o,this.router=i,this.location=r,this.alertCtrl=a,this.cartItems=[],this.totalAmount=0}ngOnInit(){var o;const i=this.router.getCurrentNavigation(),r=null===(o=null==i?void 0:i.extras)||void 0===o?void 0:o.state;r&&r.cartItems?(this.cartItems=r.cartItems,this.totalAmount=r.totalAmount||0):this.fireService.getCart().subscribe(a=>{this.cartItems=a,this.totalAmount=a.reduce((l,u)=>l+u.price*u.quantity,0)})}payNow(){return(0,v.mG)(this,void 0,void 0,function*(){yield(yield this.alertCtrl.create({header:"Enter Your Email",message:"Please enter your email address to receive the receipt.",inputs:[{name:"email",type:"email",placeholder:"you@example.com",attributes:{required:!0}}],buttons:[{text:"Cancel",role:"cancel"},{text:"Send Receipt",handler:i=>(0,v.mG)(this,void 0,void 0,function*(){const r=i.email.trim();if(!this.isValidEmail(r))return this.showInvalidEmailAlert(),!1;try{const a={id:q(),email:r,items:this.cartItems.map(d=>({id:d.id,name:d.name,price:d.price,quantity:d.quantity})),totalAmount:this.totalAmount,timestamp:new Date};yield this.fireService.saveReceipt(JSON.parse(JSON.stringify(a)));const l={to_email:r,receipt_id:a.id,total_amount:a.totalAmount.toFixed(2),timestamp:a.timestamp.toLocaleString(),items_list:a.items.map(d=>`${d.name} (x${d.quantity}) - R${d.price.toFixed(2)}`).join("\n")};yield E_send("service_yx0n32r","template_lii9gcr",l,"eKzdemI4rGn5XqTtd"),yield this.fireService.clearCart(),this.router.navigate(["/receipt"],{state:{receipt:a}})}catch(a){console.error("Payment or email failed:",a),yield(yield this.alertCtrl.create({header:"Error",message:"Failed to process payment or send email.",buttons:["OK"]})).present()}})}]})).present()})}isValidEmail(o){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(o)}showInvalidEmailAlert(){return(0,v.mG)(this,void 0,void 0,function*(){yield(yield this.alertCtrl.create({header:"Invalid Email",message:"Please enter a valid email address.",buttons:["OK"]})).present()})}goBack(){this.location.back()}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(j.Q),t.Y36(f.F0),t.Y36(p.Ye),t.Y36(s.Br))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-checkout"]],decls:41,vars:10,consts:[["color","primary"],["slot","start"],["defaultHref","/cart"],[2,"text-align","center"],[1,"ion-padding"],[1,"checkout-container"],["lines","none"],["class","cart-item",4,"ngFor","ngForOf"],[1,"divider"],[1,"total-section"],[1,"total-row"],[1,"total-row","grand-total"],["expand","block","shape","round",1,"pay-button",3,"disabled","click"],["slot","start","name","lock-closed"],[1,"secure-checkout"],["name","shield-checkmark"],[1,"cart-item"],["slot","start",4,"ngIf"],[1,"item-name"],["slot","end",1,"item-price"],[1,"item-total"],[3,"src","alt"]],template:function(o,i){1&o&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),t._UZ(3,"ion-back-button",2),t.qZA(),t.TgZ(4,"ion-title",3),t._uU(5,"Payments"),t.qZA()()(),t.TgZ(6,"ion-content",4)(7,"div",5)(8,"ion-card")(9,"ion-card-header")(10,"ion-card-title",3),t._uU(11,"Items Purchased"),t.qZA()(),t.TgZ(12,"ion-card-content")(13,"ion-list",6),t.YNc(14,z,10,11,"ion-item",7),t.qZA(),t._UZ(15,"div",8),t.TgZ(16,"div",9)(17,"div",10)(18,"span"),t._uU(19,"Subtotal"),t.qZA(),t.TgZ(20,"span"),t._uU(21),t.ALo(22,"number"),t.qZA()(),t.TgZ(23,"div",10)(24,"span"),t._uU(25,"Shipping"),t.qZA(),t.TgZ(26,"span"),t._uU(27,"Free"),t.qZA()(),t.TgZ(28,"div",11)(29,"span"),t._uU(30,"Total"),t.qZA(),t.TgZ(31,"span"),t._uU(32),t.ALo(33,"number"),t.qZA()()()()(),t.TgZ(34,"ion-button",12),t.NdJ("click",function(){return i.payNow()}),t._UZ(35,"ion-icon",13),t._uU(36," Pay Securely "),t.qZA(),t.TgZ(37,"div",14),t._UZ(38,"ion-icon",15),t.TgZ(39,"span"),t._uU(40,"Secure SSL encrypted payment"),t.qZA()()()()),2&o&&(t.xp6(14),t.Q6J("ngForOf",i.cartItems),t.xp6(7),t.hij("$",t.xi3(22,4,i.totalAmount,"1.2-2"),""),t.xp6(11),t.hij("$",t.xi3(33,7,i.totalAmount,"1.2-2"),""),t.xp6(2),t.Q6J("disabled",!(null!=i.cartItems&&i.cartItems.length)))},directives:[s.Gu,s.sr,s.Sm,s.oU,s.cs,s.wd,s.W2,s.PM,s.Zi,s.Dq,s.FN,s.q_,p.sg,s.Ie,p.O5,s.Bs,s.Q$,s.uN,s.YG,s.gu],pipes:[p.JJ],styles:[".checkout-container[_ngcontent-%COMP%]{max-width:600px;margin:0 auto}.cart-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0;--min-height: 64px;margin-bottom:12px}.cart-item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:8px;overflow:hidden}.cart-item[_ngcontent-%COMP%]   .item-name[_ngcontent-%COMP%]{color:#738678;font-size:.9rem;white-space:normal;margin-right:8px}.cart-item[_ngcontent-%COMP%]   .item-price[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;font-size:.85rem;color:var(--ion-color-medium)}.cart-item[_ngcontent-%COMP%]   .item-price[_ngcontent-%COMP%]   .item-total[_ngcontent-%COMP%]{font-weight:600;color:var(--ion-color-dark);font-size:.95rem;margin-top:4px}.divider[_ngcontent-%COMP%]{height:1px;background:var(--ion-color-light-shade);margin:16px 0}.total-section[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px;font-size:.95rem}.total-section[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-weight:500}.total-section[_ngcontent-%COMP%]   .grand-total[_ngcontent-%COMP%]{margin-top:12px;padding-top:12px;border-top:1px solid var(--ion-color-light-shade);font-size:1.1rem;font-weight:600}.pay-button[_ngcontent-%COMP%]{margin:24px 0 16px;height:48px;font-weight:600;--box-shadow: 0 4px 8px rgba(0, 0, 0, .1)}.pay-button[_ngcontent-%COMP%]:active{--box-shadow: 0 2px 4px rgba(0, 0, 0, .1)}.secure-checkout[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;color:var(--ion-color-medium);font-size:.8rem;margin-bottom:16px}.secure-checkout[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:6px;color:var(--ion-color-success)}"]}),e})()}];let L=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[f.Bz.forChild(J)],f.Bz]}),e})(),N=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[p.ez,b.u5,s.Pc,L]]}),e})()}}]);