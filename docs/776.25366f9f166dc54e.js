"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[776],{776:(I,f,d)=>{d.r(f),d.d(f,{CheckoutPageModule:()=>S});var m=d(9808),y=d(2382),c=d(8161),h=d(5852),g=d(7582);const u={_origin:"https://api.emailjs.com"};class v{constructor(n){this.status=n.status,this.text=n.responseText}}const M_send=(e,n,o,i)=>{const a=i||u._userID;return((e,n,o)=>{if(!e)throw"The user ID is required. Visit https://dashboard.emailjs.com/admin/integration";if(!n)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!o)throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"})(a,e,n),((e,n,o={})=>new Promise((i,a)=>{const s=new XMLHttpRequest;s.addEventListener("load",({target:r})=>{const l=new v(r);200===l.status||"OK"===l.text?i(l):a(l)}),s.addEventListener("error",({target:r})=>{a(new v(r))}),s.open("POST",u._origin+e,!0),Object.keys(o).forEach(r=>{s.setRequestHeader(r,o[r])}),s.send(n)}))("/api/v1.0/email/send",JSON.stringify({lib_version:"3.2.0",user_id:a,service_id:e,template_id:n,template_params:o}),{"Content-type":"application/json"})};var t=d(5e3),O=d(1447),k=d(4206);function w(e,n){if(1&e&&(t.TgZ(0,"ion-thumbnail",1),t._UZ(1,"img",21),t.qZA()),2&e){const o=t.oxw().$implicit;t.xp6(1),t.Q6J("src",o.image,t.LSH)("alt",o.name)}}function Z(e,n){if(1&e&&(t.TgZ(0,"ion-item",16),t.YNc(1,w,2,2,"ion-thumbnail",17),t._uU(2),t.ALo(3,"number"),t.TgZ(4,"ion-note",18),t._uU(5),t.ALo(6,"number"),t.TgZ(7,"div",19)(8,"ion-label",20),t._uU(9),t.qZA()()()()),2&e){const o=n.$implicit;t.xp6(1),t.Q6J("ngIf",o.image),t.xp6(1),t.hij(" R",t.xi3(3,5,o.price*o.quantity,"1.2-2")," "),t.xp6(3),t.AsE(" ",o.quantity," \xd7 R",t.xi3(6,8,o.price,"1.2-2")," "),t.xp6(4),t.Oqu(o.name)}}const A=[{path:"",component:(()=>{class e{constructor(o,i,a,s,r,l){this.fireService=o,this.router=i,this.location=a,this.alertCtrl=s,this.loadingCtrl=r,this.firestore=l,this.cartItems=[],this.totalAmount=0}ngOnInit(){var o;const i=this.router.getCurrentNavigation(),a=null===(o=null==i?void 0:i.extras)||void 0===o?void 0:o.state;a&&a.cartItems?(this.cartItems=a.cartItems,this.totalAmount=a.totalAmount||0):this.fireService.getCart().subscribe(s=>{this.cartItems=s,this.totalAmount=s.reduce((r,l)=>r+l.price*l.quantity,0)})}payNow(){return(0,g.mG)(this,void 0,void 0,function*(){yield(yield this.alertCtrl.create({header:"Enter Your Email",message:"Please enter your email address to receive the receipt.",inputs:[{name:"email",type:"email",placeholder:"you@example.com",attributes:{required:!0}}],buttons:[{text:"Cancel",role:"cancel"},{text:"Send Receipt",handler:i=>(0,g.mG)(this,void 0,void 0,function*(){const a=i.email.trim();if(!this.isValidEmail(a))return this.showInvalidEmailAlert(),!1;const s=yield this.loadingCtrl.create({message:"Processing your order..."});yield s.present();try{if(!this.cartItems||0===this.cartItems.length)throw new Error("Cart is empty");const r={id:this.fireService.firestore.firestore.collection("_").doc().id,email:a,items:this.cartItems.map(p=>({productId:p.id.toString(),name:p.name,price:p.price,quantity:p.quantity})),totalAmount:this.totalAmount,timestamp:new Date,status:"completed"};if(!(yield this.fireService.updateProductQuantities(r)))throw new Error("Failed to update product quantities");yield this.fireService.saveReceipt(r),yield this.sendEmailReceipt(a,r),yield this.fireService.clearCart(),yield s.dismiss(),this.router.navigate(["/receipt"],{state:{receipt:r},replaceUrl:!0})}catch(r){yield s.dismiss(),console.error("Checkout error:",r);const l=r instanceof Error?r.message:"Failed to complete checkout";yield(yield this.alertCtrl.create({header:"Error",message:l,buttons:["OK"]})).present()}})}]})).present()})}sendEmailReceipt(o,i){return(0,g.mG)(this,void 0,void 0,function*(){try{const a={to_email:o,receipt_id:i.id,total_amount:i.totalAmount.toFixed(2),timestamp:i.timestamp.toLocaleString(),items_list:i.items.map(s=>`${s.name} (x${s.quantity}) - R${s.price.toFixed(2)}`).join("\n")};yield M_send("service_yx0n32r","template_lii9gcr",a,"eKzdemI4rGn5XqTtd")}catch(a){console.error("Email sending failed:",a)}})}isValidEmail(o){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(o)}showInvalidEmailAlert(){return(0,g.mG)(this,void 0,void 0,function*(){yield(yield this.alertCtrl.create({header:"Invalid Email",message:"Please enter a valid email address.",buttons:["OK"]})).present()})}goBack(){this.location.back()}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(O.Q),t.Y36(h.F0),t.Y36(m.Ye),t.Y36(c.Br),t.Y36(c.HT),t.Y36(k.ST))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-checkout"]],decls:41,vars:10,consts:[["color","primary"],["slot","start"],["defaultHref","/cart"],[2,"text-align","center"],["fullscreen","",1,"ion-padding"],[1,"checkout-container"],["lines","none"],["class","cart-item",4,"ngFor","ngForOf"],[1,"divider"],[1,"total-section"],[1,"total-row"],[1,"total-row","grand-total"],["expand","block","shape","round",1,"pay-button",3,"disabled","click"],["slot","start","name","lock-closed-outline"],[1,"secure-checkout"],["name","shield-checkmark-outline"],[1,"cart-item"],["slot","start",4,"ngIf"],["slot","end",1,"item-price"],[1,"item-total"],[1,"item-name"],[3,"src","alt"]],template:function(o,i){1&o&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),t._UZ(3,"ion-back-button",2),t.qZA(),t.TgZ(4,"ion-title",3),t._uU(5,"Checkout"),t.qZA()()(),t.TgZ(6,"ion-content",4)(7,"div",5)(8,"ion-card")(9,"ion-card-header")(10,"ion-card-title"),t._uU(11,"Items Purchased"),t.qZA()(),t.TgZ(12,"ion-card-content")(13,"ion-list",6),t.YNc(14,Z,10,11,"ion-item",7),t.qZA(),t._UZ(15,"div",8),t.TgZ(16,"div",9)(17,"div",10)(18,"span"),t._uU(19,"Subtotal"),t.qZA(),t.TgZ(20,"span"),t._uU(21),t.ALo(22,"number"),t.qZA()(),t.TgZ(23,"div",10)(24,"span"),t._uU(25,"Shipping"),t.qZA(),t.TgZ(26,"span"),t._uU(27,"Free"),t.qZA()(),t.TgZ(28,"div",11)(29,"span"),t._uU(30,"Total"),t.qZA(),t.TgZ(31,"span"),t._uU(32),t.ALo(33,"number"),t.qZA()()()()(),t.TgZ(34,"ion-button",12),t.NdJ("click",function(){return i.payNow()}),t._UZ(35,"ion-icon",13),t._uU(36," Pay Securely "),t.qZA(),t.TgZ(37,"div",14),t._UZ(38,"ion-icon",15),t.TgZ(39,"span"),t._uU(40,"Secure SSL encrypted payment"),t.qZA()()()()),2&o&&(t.xp6(14),t.Q6J("ngForOf",i.cartItems),t.xp6(7),t.hij("R",t.xi3(22,4,i.totalAmount,"1.2-2"),""),t.xp6(11),t.hij("R",t.xi3(33,7,i.totalAmount,"1.2-2"),""),t.xp6(2),t.Q6J("disabled",!(null!=i.cartItems&&i.cartItems.length)))},directives:[c.Gu,c.sr,c.Sm,c.oU,c.cs,c.wd,c.W2,c.PM,c.Zi,c.Dq,c.FN,c.q_,m.sg,c.Ie,m.O5,c.Bs,c.uN,c.Q$,c.YG,c.gu],pipes:[m.JJ],styles:['.checkout-container[_ngcontent-%COMP%]{max-width:600px;margin:auto;padding:16px}ion-card[_ngcontent-%COMP%]{--background: #ffffff;--box-shadow: 0 2px 8px rgba(0, 0, 0, .05);border-radius:12px;overflow:hidden}ion-card-header[_ngcontent-%COMP%]{background-color:var(--ion-color-light);text-align:center}ion-card-title[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600;color:var(--ion-color-dark)}.cart-item[_ngcontent-%COMP%]{--padding-start: 12px;--inner-padding-end: 12px;--min-height: 74px;margin-bottom:16px;border-radius:8px;--background: #f9f9f9}.cart-item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:6px;overflow:hidden}.cart-item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.cart-item[_ngcontent-%COMP%]   .item-name[_ngcontent-%COMP%]{font-weight:500;font-size:1rem;color:var(--ion-color-medium);white-space:normal;margin-right:10px}.cart-item[_ngcontent-%COMP%]   .item-price[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;font-size:.85rem;color:var(--ion-color-medium)}.cart-item[_ngcontent-%COMP%]   .item-price[_ngcontent-%COMP%]   .item-total[_ngcontent-%COMP%]{font-weight:700;color:var(--ion-color-primary);font-size:.95rem;margin-top:4px}.divider[_ngcontent-%COMP%]{height:1px;background:var(--ion-color-light-shade);margin:20px 0}.total-section[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:12px;font-size:1rem;color:var(--ion-color-dark-shade)}.total-section[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-weight:600;color:var(--ion-color-dark)}.total-section[_ngcontent-%COMP%]   .grand-total[_ngcontent-%COMP%]{margin-top:16px;padding-top:16px;border-top:1px solid var(--ion-color-light-shade);font-size:1.2rem;font-weight:700;color:var(--ion-color-success);display:flex;justify-content:space-between}.pay-button[_ngcontent-%COMP%]{margin:32px 0 20px;height:52px;font-weight:600;font-size:1.05rem;letter-spacing:.5px;border-radius:12px;--border-radius: 12px;--background: var(--ion-color-primary);--color: var(--ion-color-primary-contrast);--box-shadow: 0 4px 20px rgba(0, 0, 0, .1), inset 0 0 0 1px rgba(255, 255, 255, .3), inset 0 0 10px rgba(255, 255, 255, .1);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);transition:all .3s ease;position:relative;overflow:hidden}.pay-button[_ngcontent-%COMP%]:active{--box-shadow: 0 2px 10px rgba(0, 0, 0, .1);transform:translateY(2px)}.pay-button[_ngcontent-%COMP%]:after{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(transparent 25%,rgba(255,255,255,.4) 35%,transparent 45%);transform:rotate(30deg);animation:shine 4s infinite;pointer-events:none;opacity:.3}.pay-button[_ngcontent-%COMP%]:hover{--background: rgba(var(--ion-color-primary-rgb), .95);--box-shadow: 0 6px 24px rgba(0, 0, 0, .2), inset 0 0 0 1px rgba(255, 255, 255, .3), inset 0 0 20px rgba(255, 255, 255, .1);transform:translateY(-2px)}@keyframes shine{0%{transform:translate(-100%) rotate(30deg)}to{transform:translate(100%) rotate(30deg)}}.secure-checkout[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;color:var(--ion-color-medium);font-size:.85rem;margin-bottom:24px}.secure-checkout[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:6px;font-size:1.1rem;color:var(--ion-color-success)}ion-list[_ngcontent-%COMP%]:hover{--box-shadow: 0 4px 16px rgba(0, 0, 0, .05)}.floating-summary[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;background:#ffffff;padding:12px 24px;box-shadow:0 -2px 12px #00000014;text-align:right;z-index:10}.floating-summary[_ngcontent-%COMP%]   .summary-text[_ngcontent-%COMP%]{font-size:1rem;color:var(--ion-color-dark)}']}),e})()}];let T=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[h.Bz.forChild(A)],h.Bz]}),e})(),S=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[m.ez,y.u5,c.Pc,T]]}),e})()}}]);